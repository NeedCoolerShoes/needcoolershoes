<!-- NOTHING TO TRANSLATE -->
<%
  data ||= ""
  height ||= 400
  width ||= 300
  model ||= nil
%>
<% content_for :scripts do %>
  <script src="/ncsassets/js/skinview3d.bundle.js"></script>
<% end %>

<canvas id="skin_container"></canvas>

<script>
  const skinViewer = new skinview3d.SkinViewer({
    canvas: document.getElementById("skin_container"),
    width: <%= width %>,
    height: <%= height %>,
    model: "<%= model.present? ? model : "auto-detect" %>",
    skin: "<%= data %>"
  });

  const canvas = document.getElementById("skin_container")
  canvas.style.setProperty("max-width", "100%")
  canvas.style.setProperty("max-height", "100%")

  const parent = canvas.parentElement

  function updateSize(width, height) {
    width = Math.floor(width)
    height = Math.floor(height)
    skinViewer.width = width
    skinViewer.height = height
  }

  updateSize(parent.clientWidth, parent.clientHeight)

  const resizeObserver = new ResizeObserver(
    entries => {
      const entry = entries[0]
      updateSize(entry.contentRect.width, entry.contentRect.height)
    }
  )

  resizeObserver.observe(parent)
</script>